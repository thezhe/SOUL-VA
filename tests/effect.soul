/** A copy of '../examples/main.soulpatch' for testing */

namespace main
{
    /*' effect' namespace definition */
    namespace effect = VA::HighLevel::TheExpressor; 
    
    using inType = effect::InType;
    using outType = effect::OutType;

    graph Processor [[main]]
    {
        input stream inType32 in;
        output stream outType32 out;

       // output stream VA::SampleType grOut;

        let
        { 
            e = effect::Processor; 

            encode32 = Encode32::Processor;
            decode32 = Decode32::Processor;
        }

        connection
        {       
            in -> decode32 -> e.in;
            e.out -> encode32 -> out;
        }
    }

/*==============================================================================
CLI/Octave compatibility code                       
==============================================================================*/

    using inType32 = float<inType.size>;
    using outType32 = float<outType.size>;

    namespace Decode32
    {     
        inType process (inType32 x)
        {
            inType y;

            for (int i = 0; i < inType32.size; ++i)
                y.at(i) = inType.elementType (x.at(i));
            
            return y;
        }

        processor Processor()
        {
            input stream inType32 in;
            output stream inType out;
    
            void run()
            {   
                loop
                {
                    out << process (in);

                    advance();
                }
            }
        }
    }

    namespace Encode32
    {     
        outType32 process (outType x)
        {
            outType32 y;

            for (int i = 0; i < outType.size; ++i)
                y.at(i) = outType32.elementType (x.at(i));
            
            return y;
        }

        processor Processor()
        {
            input stream outType in;
            output stream outType32 out;
    
            void run()
            {   
                loop
                {
                    out << process (in);

                    advance();
                }
            }
        }
    }


}